<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Sistema de Control de Invernadero - ESP32</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ±</text></svg>">
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>ğŸŒ± Sistema de Control de Invernadero</h1>
      <p class="subtitle">Monitoreo y control en tiempo real - ESP32</p>
      <div class="status-bar">
        <span id="connection-status" class="status disconnected">Desconectado</span>
        <span class="status" id="last-update">Ãšltima actualizaciÃ³n: --:--:--</span>
      </div>
    </header>

    <div class="dashboard">
      <!-- SecciÃ³n de Sensores -->
      <div class="card sensor-card">
        <div class="card-header">
          <h2><span class="icon">ğŸ“Š</span> Sensores</h2>
        </div>
        <div class="card-content">
          <div class="sensor-grid">
            <div class="sensor-item">
              <div class="sensor-label">Temperatura LM35</div>
              <div class="sensor-value">
                <span id="temp">--</span>
                <span class="unit">Â°C</span>
              </div>
              <div class="sensor-description">Temperatura directa del suelo</div>
            </div>
            
            <div class="sensor-item">
              <div class="sensor-label">Temperatura Ambiente</div>
              <div class="sensor-value">
                <span id="tempAmb">--</span>
                <span class="unit">Â°C</span>
              </div>
              <div class="sensor-description">DHT11 - Temperatura del aire</div>
            </div>
            
            <div class="sensor-item">
              <div class="sensor-label">Humedad Ambiente</div>
              <div class="sensor-value">
                <span id="hum">--</span>
                <span class="unit">%</span>
              </div>
              <div class="sensor-description">DHT11 - Humedad relativa</div>
            </div>
            
            <div class="sensor-item">
              <div class="sensor-label">Humedad del Suelo</div>
              <div class="sensor-value">
                <span id="soil">--</span>
                <span class="unit">ADC</span>
              </div>
              <div class="sensor-description">0-4095 (menor = mÃ¡s seco)</div>
              <div class="soil-indicator">
                <div class="soil-bar">
                  <div id="soil-fill" class="soil-fill"></div>
                </div>
                <div class="soil-labels">
                  <span>Seco</span>
                  <span>Ã“ptimo</span>
                  <span>HÃºmedo</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SecciÃ³n de Control de Actuadores -->
      <div class="card control-card">
        <div class="card-header">
          <h2><span class="icon">âš™ï¸</span> Control de Actuadores</h2>
          <div class="mode-toggle">
            <span class="mode-label">Modo:</span>
            <button id="mode-toggle" class="toggle-btn auto-mode">AUTO</button>
          </div>
        </div>
        <div class="card-content">
          <div class="actuator-grid">
            <div class="actuator-item">
              <div class="actuator-info">
                <h3>ğŸŒ¡ï¸ Foco Calefactor</h3>
                <p class="actuator-desc">Control de temperatura</p>
              </div>
              <div class="actuator-control">
                <div class="status-indicator">
                  <span id="foco-status" class="status-off">OFF</span>
                  <div id="foco-led" class="led led-off"></div>
                </div>
                <button id="foco-btn" class="control-btn btn-off" onclick="toggleDeviceWS('foco')">
                  Encender
                </button>
              </div>
            </div>

            <div class="actuator-item">
              <div class="actuator-info">
                <h3>ğŸ’¨ Ventilador</h3>
                <p class="actuator-desc">RefrigeraciÃ³n y circulaciÃ³n</p>
              </div>
              <div class="actuator-control">
                <div class="status-indicator">
                  <span id="vent-status" class="status-off">OFF</span>
                  <div id="vent-led" class="led led-off"></div>
                </div>
                <button id="vent-btn" class="control-btn btn-off" onclick="toggleDevice('vent')">
                  Encender
                </button>
              </div>
            </div>

            <div class="actuator-item">
              <div class="actuator-info">
                <h3>ğŸ’§ Bomba de Riego</h3>
                <p class="actuator-desc">Sistema de irrigaciÃ³n</p>
              </div>
              <div class="actuator-control">
                <div class="status-indicator">
                  <span id="bomba-status" class="status-off">OFF</span>
                  <div id="bomba-led" class="led led-off"></div>
                </div>
                <button id="bomba-btn" class="control-btn btn-off" onclick="toggleDevice('bomba')">
                  Encender
                </button>
              </div>
            </div>
          </div>
          
          <div class="protections-info">
            <h4>â±ï¸ Protecciones de Tiempo</h4>
            <ul>
              <li>Foco: mÃ¡ximo 5 minutos continuos</li>
              <li>Ventilador: mÃ¡ximo 5 minutos continuos</li>
              <li>Bomba: mÃ¡ximo 10 minutos continuos</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- SecciÃ³n de ConfiguraciÃ³n -->
      <div class="card config-card">
        <div class="card-header">
          <h2><span class="icon">âš¡</span> ConfiguraciÃ³n de Umbrales</h2>
        </div>
        <div class="card-content">
          <div class="config-grid">
            <div class="config-item">
              <label for="tmin">Temperatura MÃ­nima (Â°C)</label>
              <div class="input-group">
                <input type="number" id="tmin" value="20" step="0.1" min="0" max="50">
                <span class="input-unit">Â°C</span>
              </div>
              <p class="config-description">Encender foco si baja de este valor</p>
            </div>
            
            <div class="config-item">
              <label for="tmax">Temperatura MÃ¡xima (Â°C)</label>
              <div class="input-group">
                <input type="number" id="tmax" value="24" step="0.1" min="0" max="50">
                <span class="input-unit">Â°C</span>
              </div>
              <p class="config-description">Encender ventilador si supera este valor</p>
            </div>
            
            <div class="config-item">
              <label for="slow">Umbral Suelo Bajo (ADC)</label>
              <div class="input-group">
                <input type="number" id="slow" value="400" step="10" min="0" max="4095">
              </div>
              <p class="config-description">Activar bomba si ADC â‰¤ este valor</p>
            </div>
            
            <div class="config-item">
              <label for="shigh">Umbral Suelo Alto (ADC)</label>
              <div class="input-group">
                <input type="number" id="shigh" value="2000" step="10" min="0" max="4095">
              </div>
              <p class="config-description">Desactivar bomba si ADC â‰¥ este valor</p>
            </div>
          </div>
          
          <div class="config-actions">
            <button class="btn-save" onclick="saveConfigWS()">
              ğŸ’¾ Guardar ConfiguraciÃ³n
            </button>
            <button class="btn-default" onclick="loadDefaultConfig()">
              ğŸ”„ Valores por Defecto
            </button>
          </div>
        </div>
      </div>

      <!-- SecciÃ³n de GrÃ¡ficas -->
      <div class="card chart-card">
        <div class="card-header">
          <h2><span class="icon">ğŸ“ˆ</span> GrÃ¡ficas en Tiempo Real</h2>
          <div class="chart-controls">
            <button id="temp-chart-btn" class="chart-btn active" onclick="showChart('temp')">ğŸŒ¡ï¸ Temp</button>
            <button id="hum-chart-btn" class="chart-btn" onclick="showChart('hum')">ğŸ’§ Hum</button>
            <button id="soil-chart-btn" class="chart-btn" onclick="showChart('soil')">ğŸŒ± Suelo</button>
          </div>
        </div>
        <div class="card-content">
          <div class="chart-container">
            <canvas id="chart" width="400" height="200"></canvas>
          </div>
          <div class="chart-info">
            <p>Mostrando Ãºltimos 30 puntos de datos (actualizaciÃ³n cada 2 segundos)</p>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <p>Sistema de Control de Invernadero - ESP32 | 
        <span id="ip-address">Conectando...</span> | 
        <span id="firmware-version">v1.0.0</span>
      </p>
      <p class="footer-note">
        ğŸŒ¿ Cultivando el futuro con tecnologÃ­a IoT
      </p>
    </footer>
  </div>

  <script src="script.js"></script>
  <script src="chart.js"></script>
</body>
</html>